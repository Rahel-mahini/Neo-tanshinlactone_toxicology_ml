# Neo-Tanshinlactone Cytotoxicity Prediction Pipeline

This repository contains a **multi-task machine learning pipeline** to predict cytotoxicity of Neo-Tanshinlactone compounds across multiple cell lines using **molecular descriptors** generated from SMILES strings.

---

## ðŸ”¹ Project Overview

The pipeline performs the following steps:

1. **Load data**  
   Reads a CSV file containing compound information, SMILES strings, and cytotoxicity targets (MCF-7, SK-BR-3).

2. **Generate molecular descriptors**  
   Uses **RDKit** to compute all available molecular descriptors. Constant, NaN, or highly correlated descriptors are automatically removed.

3. **Round-Robin Cluster Split Algorithm**  
   - Performs KMeans clustering on UMAP embeddings.  
   - Uses the **gap statistic** to determine the optimal number of clusters.  
   - Uses size-controlled hierarchical clustering  to recursively subcluster the larger size cluster from previous step.
   - Uses Round & Robin distribution algorithm to select test samples proportionally from each cluster, ensuring representative coverage. 
   - Splits the dataset into `X_train`, `X_test`, `y_train`, and `y_test` using cluster-guided selection.

4. **Feature selection**  
   - Uses **MultiTaskLasso + Recursive Feature Elimination (RFE)** to select top 15 features for all targets simultaneously.  
   - Uses **multi-task XGBoost model Feature Importance** to select top 15 features for all targets simultaneously.
   - Combines the features and provides top 30 features for downstream modeling.

5. **Train multi-task regression models**  
   - Fits **multi-task GradientBoosting regression** using the selected descriptors.   
   - Evaluates models using RÂ², MAE, MSE, RMSE, and leave-one-out RÂ² metrics.  
   - Supports training with 1, 2, 3, up to 10 features combinations.

   ```python
   models = {
    
       "GB": MultiOutputRegressor(GradientBoostingRegressor()),
   }
6. **Hyperparameter optimiation**
   - After selecting the most informative descriptors, hyperparameter optimization was performed using our combination-based search procedure.

7. **Save results**  
   - Trained model saved as `.pkl`.  
   - Models evaluation metrics saved as `.csv`.  
   - Selected features saved as `.csv`.

8. **Visualization and save plots**
   - All plots generated by the workflow will be saved in the output/plots directory:
   - Correlation plots â€“ Scatter plots of experimental vs. predicted target values for each target.
   - Williams plot â€“ Used for applicability domain visualization of the regression models.
   - ALE (Accumulated Local Effects) plots â€“ Visualize feature effects on the predictions.
   - UMAP plot â€“ 2D projection of the compounds based on descriptors.
   - UMAP + KMeans plot â€“ Visualization of clustering on the UMAP embedding with cluster assignments.

---

## Installation

1. Clone the repository:

```bash
git clone https://github.com/Rahel-mahini/Neo-tanshinlactone_toxicology_ml.git
cd Neo-tanshinlactone_toxicology_ml
pip install -r requirements.txt
python main.py

```